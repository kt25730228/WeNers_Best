<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>ìœ„ë„ˆìŠ¤ ê²½ë§¤</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="config.js"></script> 

<style>
  body { font-family: system-ui, -apple-system, sans-serif; }
  /* ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ (ì›ë³¸ ìœ ì§€) */
  @keyframes fadeA { 0%, 45% { opacity: 1; } 55%, 100% { opacity: 0.15; } }
  @keyframes fadeB { 0%, 45% { opacity: 0.15; } 55%, 100% { opacity: 1; } }
  .fade-a { animation: fadeA 3s infinite ease-in-out; }
  .fade-b { animation: fadeB 3s infinite ease-in-out; }
  @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
  .animate-float { animation: float 4s ease-in-out infinite; }
  .animate-float-delay { animation: float 4s ease-in-out infinite; animation-delay: 2s; }
</style>
</head>
<body class="bg-gray-50 min-h-screen">

<header class="bg-white shadow-md sticky top-0 z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <a href="index.html" class="flex items-center space-x-2">
                <span class="text-3xl font-extrabold text-blue-600">WeNers</span>
                <span class="text-xs text-gray-500 hidden sm:inline">ê²½ë§¤ í”Œë«í¼</span>
            </a>

            <div class="flex items-center space-x-4">
                <span id="userBox" class="text-sm text-gray-700 font-medium hidden sm:block"></span>

                <a id="loginBtn" href="auth_login.html" class="bg-blue-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-blue-700 transition duration-150 ease-in-out">
                    ë¡œê·¸ì¸
                </a>
                <a id="signupBtn" href="auth_signup.html" class="text-gray-600 px-3 py-1.5 rounded-lg text-sm font-medium hover:bg-gray-100 transition duration-150 ease-in-out">
                    íšŒì›ê°€ì…
                </a>
                
                <button id="logoutBtn" onclick="logout()" style="display: none;" class="bg-red-500 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-red-600 transition duration-150 ease-in-out">
                    ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
        </div>
    </div>
</header>

<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">ğŸ”¥ ì‹¤ì‹œê°„ ê²½ë§¤ ìƒí’ˆ</h1>
        <a id="createProductBtn" href="auth_login.html" class="flex items-center space-x-2 bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition duration-150 ease-in-out">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            <span>ìƒí’ˆ ë“±ë¡</span>
        </a>
    </div>

    <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
        <p class="col-span-full text-center text-gray-500 py-10">ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
</main>

<footer class="mt-20 py-8 border-t bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
        &copy; 2025 WeNers Auction Platform. All rights reserved.
    </div>
</footer>

<div id="bidHistoryModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-2xl w-full max-w-md p-6">
        <div class="flex justify-between items-center border-b pb-3 mb-4">
            <h3 id="modalTitle" class="text-xl font-bold text-gray-800">ì…ì°° ê¸°ë¡</h3>
            <button onclick="closeBidModal()" class="text-gray-500 hover:text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        
        <div id="bidHistoryList" class="max-h-80 overflow-y-auto space-y-2">
            <p class="text-center text-gray-500 py-4">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
        
        <div class="mt-4 pt-3 border-t text-sm text-gray-600">
            <p id="currentHighestBid">í˜„ì¬ ìµœê³ ê°€: -</p>
        </div>
    </div>
</div>


<script>
// config.jsì—ì„œ ì „ì—­ìœ¼ë¡œ ì„¤ì •ëœ í‚¤/URLì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
const SUPABASE_URL_FROM_WINDOW = window.SUPABASE_URL;
const SUPABASE_ANON_KEY_FROM_WINDOW = window.SUPABASE_ANON_KEY;

let currentUser = null; 
let auctionEndDates = new Map(); // ìƒí’ˆ ë§ˆê° ì‹œê°„ì„ ì €ì¥í•  Map
let timerInterval = null;        // íƒ€ì´ë¨¸ ì¸í„°ë²Œ ID

// ğŸ”¥ 1. Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜ (ì„¸ì…˜ ìœ ì§€ë¥¼ ìœ„í•´ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •)
function initializeSupabase() {
    if (SUPABASE_URL_FROM_WINDOW && SUPABASE_ANON_KEY_FROM_WINDOW) {
        if (window.supabase && typeof window.supabase.createClient === 'function') {
            supabase = window.supabase.createClient(SUPABASE_URL_FROM_WINDOW, SUPABASE_ANON_KEY_FROM_WINDOW, {
                // â­ í•µì‹¬ ìˆ˜ì •: persistSessionì„ trueë¡œ ì„¤ì •í•˜ì—¬ ì„¸ì…˜ì„ ìœ ì§€í•©ë‹ˆë‹¤.
                auth: { persistSession: true, autoRefreshToken: true } 
            });
            // ì „ì—­ window.supabaseì— í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ í• ë‹¹ (ë‹¤ë¥¸ íŒŒì¼ê³¼ì˜ í†µì¼ì„± ìœ ì§€)
            window.supabase = supabase;
            console.log("Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì„±ê³µ (ì„¸ì…˜ ìœ ì§€ ì„¤ì • ì™„ë£Œ)");
        } else {
            console.error("Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        }
    } else {
        console.error("Supabase URL ë˜ëŠ” Keyê°€ config.jsì— ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
    }
}

// ----------------------------------------------------
// ğŸ”¥ 2. ì¸ì¦ ë° UI ê´€ë¦¬ (checkAuthAndInit í•¨ìˆ˜ ì¬êµ¬ì„±)
// ----------------------------------------------------

async function checkAuthAndInit() {
    // 1. í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì‹œë„
    initializeSupabase();

    if (!supabase) {
        document.getElementById('product-list').innerHTML = '<p class="col-span-full text-center py-10 text-red-500">Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨. config.jsë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>';
        return;
    }
    
    // 2. í˜„ì¬ ì„¸ì…˜ ì •ë³´ë¥¼ ê°€ì ¸ì™€ currentUserë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (ì„¸ì…˜ ë³µì›)
    const { data: { session } } = await supabase.auth.getSession();
    currentUser = session ? session.user : null;

    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const signupBtn = document.getElementById('signupBtn');
    const userBox = document.getElementById('userBox');
    const createBtn = document.getElementById('createProductBtn');

    // 3. ì¸ì¦ ìƒíƒœì— ë”°ë¥¸ UI ì—…ë°ì´íŠ¸
    if (currentUser) {
        if (loginBtn) loginBtn.style.display = 'none';
        if (signupBtn) signupBtn.style.display = 'none';
        if (logoutBtn) logoutBtn.style.display = 'inline-flex';
        if (userBox) userBox.textContent = `í™˜ì˜í•©ë‹ˆë‹¤, ${currentUser.email.split('@')[0]}ë‹˜!`;
        // â­ ìƒí’ˆ ë“±ë¡ ë²„íŠ¼ ë§í¬ ë³€ê²½ (ë¡œê·¸ì¸ ì™„ë£Œ)
        if (createBtn) createBtn.href = 'create_with_image_upload_auth.html'; 
    } else {
        if (loginBtn) loginBtn.style.display = 'inline-flex';
        if (signupBtn) signupBtn.style.display = 'inline-flex';
        if (logoutBtn) logoutBtn.style.display = 'none';
        if (userBox) userBox.textContent = '';
        // â­ ìƒí’ˆ ë“±ë¡ ë²„íŠ¼ ë§í¬ ìœ ì§€ (ë¡œê·¸ì¸ í•„ìš”)
        if (createBtn) createBtn.href = 'auth_login.html'; 
    }
    
    // 4. ìƒí’ˆ ë¡œë“œ ë° ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘
    loadProductsAndBids();
    subscribeToRealtime();
    
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(updateTimers, 1000);
}

// ----------------------------------------------------
// ğŸ”¥ 3. ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ (logout ì‹œ ë¦¬ë””ë ‰ì…˜)
// ----------------------------------------------------
async function logout() {
    if (!supabase) return;
    const { error } = await supabase.auth.signOut();
    if (error) {
        alert('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ' + error.message);
    } else {
        alert('ë¡œê·¸ì•„ì›ƒ ì„±ê³µ');
        // ë¡œê·¸ì•„ì›ƒ í›„ ìƒˆë¡œê³ ì¹¨ ëŒ€ì‹  ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì 
        window.location.href = "auth_login.html"; 
    }
}


// ----------------------------------------------------
// ğŸ”¥ 4. ê¸°ì¡´ ê²½ë§¤ ë¡œì§ (loadProductsAndBids, renderProductCard, placeBid ë“±)
//      â€» ì½”ë“œëŠ” ì›ë³¸ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤.
// ----------------------------------------------------

async function getLatestBid(productId) {
    // ... (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    if (!supabase) return null;
    const { data: bids, error } = await supabase
        .from('bids')
        .select('price, bidder_id, created_at')
        .eq('product_id', productId)
        .order('price', { ascending: false })
        .limit(1);

    if (error) {
        console.error('ì…ì°°ê°€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
        return null;
    }
    return bids[0] || null;
}

async function loadProductsAndBids() {
    if (!supabase) return;
    const listEl = document.getElementById('product-list');
    if (!listEl) return;
    
    listEl.innerHTML = '<p class="text-center col-span-full py-10 text-gray-500">ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
    auctionEndDates.clear(); 

    const { data: products, error: productError } = await supabase
        .from('products')
        .select('*')
        .eq('is_sold', false) 
        .order('end_date', { ascending: true }); 

    if (productError) {
        listEl.innerHTML = '<p class="col-span-full text-center py-10 text-red-500">ìƒí’ˆ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + productError.message + '</p>';
        return;
    }
    
    if (!products || products.length === 0) {
        listEl.innerHTML = '<p class="col-span-full text-center py-10 text-gray-500">ë“±ë¡ëœ ê²½ë§¤ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤. ìƒí’ˆì„ ë“±ë¡í•´ ë³´ì„¸ìš”.</p>';
        return;
    }
    
    let html = '';
    for (const product of products) {
        auctionEndDates.set(product.id, new Date(product.end_date).getTime());
        const latestBid = await getLatestBid(product.id);
        html += renderProductCard(product, latestBid);
    }
    listEl.innerHTML = html;

    updateTimers(); 
}

function renderProductCard(product, latestBid) {
    // ... (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    const isEvent = product.type === 'event';
    const currentPrice = latestBid ? latestBid.price : product.price_start;
    const bidCount = latestBid ? 'ì…ì°° 1íšŒ ì´ìƒ' : 'ì²« ì…ì°°ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤';
    
    let imageUrl = '';
    if (product.images && product.images.length > 0) {
        imageUrl = Array.isArray(product.images) ? product.images[0] : product.images;
    }

    const isFinished = new Date(product.end_date) <= new Date();

    const timerHtml = `<span id="timer-${product.id}" class="text-xs text-gray-500">ê³„ì‚° ì¤‘...</span>`;

    return `
        <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 overflow-hidden ${isFinished ? 'opacity-70 grayscale' : ''}" data-product-id="${product.id}">
            <a href="detail.html?id=${product.id}">
                ${imageUrl ? `<img class="w-full h-48 object-cover hover:opacity-80 transition" src="${imageUrl}" alt="${product.title}">` : `<div class="w-full h-48 bg-gray-200 flex items-center justify-center text-gray-500">ì´ë¯¸ì§€ ì—†ìŒ</div>`}
            </a>
            
            <div class="p-5">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs font-semibold px-2 py-1 rounded-full ${isEvent ? 'bg-yellow-100 text-yellow-700' : 'bg-indigo-100 text-indigo-700'}">${isEvent ? 'ì´ë²¤íŠ¸ ê²½ë§¤' : 'ì¼ë°˜ ê²½ë§¤'}</span>
                    ${timerHtml}
                </div>
                <a href="detail.html?id=${product.id}" class="hover:text-blue-600 transition duration-150">
                    <h3 class="text-xl font-bold text-gray-800 truncate">${product.title}</h3>
                </a>
                <p class="text-sm text-gray-600 mb-4">${product.description ? product.description.substring(0, 50) + (product.description.length > 50 ? '...' : '') : 'ìƒí’ˆ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.'}</p>
                
                <div class="border-t border-b py-3 mb-4">
                    <p class="text-gray-500 text-sm">í˜„ì¬ê°€</p>
                    <p class="text-2xl font-extrabold text-blue-600">â‚© ${currentPrice.toLocaleString('ko-KR')}</p>
                    <p class="text-xs text-gray-400 mt-1">${bidCount}</p>
                </div>

                <button onclick="showBidModal(${product.id}, '${product.title.replace(/'/g, "\\'")}')" 
                        class="w-full bg-gray-200 text-gray-700 py-1 mb-3 rounded-lg text-sm font-medium hover:bg-gray-300 transition duration-150 ease-in-out">
                    ì…ì°° ë‚´ì—­ ë³´ê¸°
                </button>
                
                ${!isFinished ? `
                    <div class="flex items-center space-x-2 mb-4">
                        <input type="number" id="bid-input-${product.id}" placeholder="ì…ì°° ê¸ˆì•¡ (ìµœì†Œ ${currentPrice + 1}ì›)" 
                            min="${currentPrice + 1}" class="w-full border rounded-lg p-2 text-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <button onclick="placeBid(${product.id})" 
                            class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition duration-150 ease-in-out disabled:opacity-50">
                        ì¦‰ì‹œ ì…ì°°
                    </button>
                ` : `
                    <button disabled class="w-full bg-gray-400 text-white py-2 rounded-lg font-semibold">
                        ê²½ë§¤ ë§ˆê°
                    </button>
                `}
            </div>
        </div>
    `;
}

async function placeBid(productId) {
    if (!currentUser) {
        alert('ë¡œê·¸ì¸ í›„ ì…ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
        return window.location.href = 'auth_login.html';
    }
    // ... (ë‚˜ë¨¸ì§€ ì…ì°° ë¡œì§ ìœ ì§€)
    const bidInput = document.getElementById(`bid-input-${productId}`);
    const bidAmount = Number(bidInput.value);

    if (isNaN(bidAmount) || bidAmount <= 0) {
        return alert('ìœ íš¨í•œ ê¸ˆì•¡ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
    }

    const endTime = auctionEndDates.get(productId);
    if (endTime && endTime <= new Date().getTime()) {
        alert('ê²½ë§¤ê°€ ì´ë¯¸ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.');
        loadProductsAndBids();
        return;
    }

    const { data: productData } = await supabase.from('products').select('price_start').eq('id', productId).single();
    const latestBid = await getLatestBid(productId);
    
    const priceStart = productData.price_start || 0;
    const currentPrice = latestBid ? latestBid.price : priceStart;
    
    if (bidAmount <= currentPrice) {
        return alert(`í˜„ì¬ ìµœê³ ê°€(${currentPrice.toLocaleString('ko-KR')}ì›)ë³´ë‹¤ ë†’ì€ ê¸ˆì•¡ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.`);
    }

    const { error } = await supabase
        .from('bids')
        .insert([{ 
            product_id: productId, 
            bidder_id: currentUser.id, 
            price: bidAmount 
        }]);

    if (error) {
        return alert('ì…ì°° ì‹¤íŒ¨: ' + error.message);
    }

    alert('ì…ì°° ì„±ê³µ! ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.');
    bidInput.value = ''; 
}

function subscribeToRealtime() {
    // ... (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    if (!supabase) return;

    supabase.channel('public:bids_changes')
        .on('postgres_changes', { 
            event: 'INSERT', 
            schema: 'public', 
            table: 'bids' 
        }, payload => {
            console.log('ìƒˆë¡œìš´ ì…ì°° ê°ì§€:', payload);
            loadProductsAndBids(); 
        })
        .subscribe();
    
    supabase.channel('public:products_changes')
        .on('postgres_changes', {
            event: '*', 
            schema: 'public', 
            table: 'products' 
        }, payload => {
            console.log('ìƒí’ˆ ë°ì´í„° ë³€ê²½ ê°ì§€:', payload);
            loadProductsAndBids(); 
        })
        .subscribe();
}

function updateTimers() {
    // ... (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    const now = new Date().getTime();

    auctionEndDates.forEach((endTime, productId) => {
        const remainingTime = endTime - now;
        const timerEl = document.getElementById(`timer-${productId}`);
        
        if (!timerEl) return; 

        if (remainingTime <= 0) {
            timerEl.innerHTML = '<span class="text-red-500 font-bold">ê²½ë§¤ ë§ˆê°</span>';
            
            if (timerEl.dataset.finished !== 'true') {
                 timerEl.dataset.finished = 'true';
                 loadProductsAndBids(); 
            }
        } else {
            const days = Math.floor(remainingTime / (1000 * 60 * 60 * 24));
            const hours = Math.floor((remainingTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);

            let timeString = '';
            if (days > 0) {
                timeString += `${days}ì¼ `;
            }
            timeString += `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')} ë‚¨ìŒ`;
            
            timerEl.textContent = timeString;
            
            if (remainingTime < 3600000) { 
                timerEl.classList.add('text-red-600', 'font-bold');
            } else {
                timerEl.classList.remove('text-red-600', 'font-bold');
            }
        }
    });
}

async function showBidModal(productId, productTitle) {
    // ... (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    if (!supabase) return alert('Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨');

    const modal = document.getElementById('bidHistoryModal');
    const titleEl = document.getElementById('modalTitle');
    const listEl = document.getElementById('bidHistoryList');
    const highestEl = document.getElementById('currentHighestBid');

    if (!modal || !listEl) return;

    titleEl.textContent = `${productTitle} - ì…ì°° ê¸°ë¡`;
    listEl.innerHTML = '<p class="text-center text-blue-500 py-4">ì…ì°° ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
    highestEl.textContent = 'í˜„ì¬ ìµœê³ ê°€: -';
    modal.style.display = 'flex'; 

    const { data: bids, error } = await supabase
        .from('bids')
        .select('price, bidder_id, created_at')
        .eq('product_id', productId)
        .order('price', { ascending: false });

    if (error) {
        listEl.innerHTML = '<p class="text-center text-red-500 py-4">ì…ì°° ë‚´ì—­ ë¡œë“œ ì‹¤íŒ¨: ' + error.message + '</p>';
        return;
    }

    if (!bids || bids.length === 0) {
        const productData = await supabase.from('products').select('price_start').eq('id', productId).single();
        const startPrice = productData.data?.price_start || 0;

        highestEl.textContent = `í˜„ì¬ ìµœê³ ê°€: â‚© ${startPrice.toLocaleString('ko-KR')}`;
        listEl.innerHTML = '<p class="text-center text-gray-500 py-4">ì•„ì§ ì…ì°° ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
    }

    const maxPrice = bids[0].price;
    highestEl.textContent = `í˜„ì¬ ìµœê³ ê°€: â‚© ${maxPrice.toLocaleString('ko-KR')}`;

    listEl.innerHTML = bids.map(bid => {
        const bidderPrefix = bid.bidder_id ? bid.bidder_id.substring(0, 3) : 'ìµëª…';
        const maskedEmail = bidderPrefix + '****'; 
        const time = new Date(bid.created_at).toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        
        return `
            <div class="flex justify-between items-center p-3 border rounded-md ${bid.price === maxPrice ? 'bg-yellow-50 border-yellow-300 font-bold' : 'bg-white'}">
                <span class="text-lg text-blue-600">â‚© ${bid.price.toLocaleString('ko-KR')}</span>
                <div class="text-right">
                    <span class="block text-sm text-gray-700">${maskedEmail}</span>
                    <span class="block text-xs text-gray-500">${time}</span>
                </div>
            </div>
        `;
    }).join('');
}

function closeBidModal() {
    // ... (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    const modal = document.getElementById('bidHistoryModal');
    if (modal) {
        modal.style.display = 'none';
    }
}


// ----------------------------------------------------
// ğŸ”¥ 5. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ì  (DOM ë¡œë“œ í›„ ì¸ì¦ ì²´í¬)
// ----------------------------------------------------
document.addEventListener('DOMContentLoaded', checkAuthAndInit);
</script>

</body>
</html>
