<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ìƒí’ˆë“±ë¡ (ì´ë¯¸ì§€ ì—…ë¡œë“œ) - WeNers</title>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="config.js"></script>

<style>
body { font-family: Arial; width: 400px; margin: 30px auto;}
input, textarea {width: 100%; padding: 8px; margin-bottom:10px;}
button { width: 100%; padding:10px; background:#0066ff;color:white; font-weight:bold;}
</style>
</head>
<body>

<h2>ğŸ›’ ì‹ ê·œ ìƒí’ˆ ë“±ë¡</h2>

<input id="title" placeholder="ìƒí’ˆ ì œëª©"/>
<textarea id="desc" placeholder="ì„¤ëª…"></textarea>
<input id="price_start" type="number" placeholder="ì‹œì‘ê°€"/>
<input id="price_end" type="number" placeholder="ì¦‰ì‹œêµ¬ë§¤ê°€(ì„ íƒ)"/>
<input id="image" type="file"/>

<button onclick="submitProduct()">ğŸ“Œ ìƒí’ˆ ë“±ë¡</button>
<p><a href="weners_with_bids_realtime_auth.html">â† ëª©ë¡ìœ¼ë¡œ</a></p>

<script>
// ğŸ”¥ Supabase ì—°ê²° â€” config.jsì˜ KEY/URL ì‚¬ìš©
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ë¡œê·¸ì¸ ì²´í¬
supabase.auth.getSession().then(({ data })=>{
 if(!data.session) {
    alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì„¸ìš”.");
    location.href="auth_login.html";
 }
});

// ğŸ“Œ ìƒí’ˆ ì—…ë¡œë“œ
async function submitProduct(){
 const file = document.getElementById("image").files[0];
 if(!file) return alert("ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");

 const fileName = `${Date.now()}_${file.name}`;

 // storage ì—…ë¡œë“œ
 const { data:imgData, error:imgErr } = await supabase
     .storage.from("product-images")
     .upload(fileName, file);

 if(imgErr) return alert("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: "+imgErr.message);

 const imageUrl = `${SUPABASE_URL}/storage/v1/object/public/product-images/${fileName}`;

 // DB ì €ì¥
 const { error } = await supabase.from("products").insert({
     title: title.value,
     description: desc.value,
     price_start: Number(price_start.value),
     price_end: Number(price_end.value),
     images: imageUrl,
     created_at: new Date(),
 });

 if(error) return alert("DB ì €ì¥ ì˜¤ë¥˜: "+error.message);

 alert("ğŸ‰ ìƒí’ˆ ë“±ë¡ ì™„ë£Œ!");
 location.href="weners_with_bids_realtime_auth.html";
}
</script>
</body>
</html>
