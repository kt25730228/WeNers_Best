<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë¡œê·¸ì¸ | WeNers</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: system-ui, -apple-system, sans-serif; width: 400px; margin: 50px auto; padding: 20px; border: 1px solid #eee; border-radius: 8px; background-color: #fff;}
  h2 { font-size: 1.5rem; margin-bottom: 20px; color: #1f2937; }
  input { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
  button { width: 100%; padding: 10px; background: #2563eb; color: white; font-weight: bold; border-radius: 4px; cursor: pointer; transition: background-color 0.15s; }
  button:hover { background-color: #1d4ed8; }
  p { margin-top: 15px; text-align: center; }
  a { color: #2563eb; text-decoration: none; }
</style>
</head>
<body>

<div class="max-w-md mx-auto p-8 bg-white rounded-lg shadow-xl">
    <h2 class="text-2xl font-bold text-center">ğŸ” ë¡œê·¸ì¸</h2>
    
    <input id="email" type="email" placeholder="ì´ë©”ì¼ ì…ë ¥" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"/><br>
    <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"/><br>
    
    <button id="btnLogin" onclick="login()" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">ë¡œê·¸ì¸</button>
    
    <p class="text-center text-sm mt-4">
        <a href="auth_signup.html" class="text-blue-600 hover:text-blue-800">ì•„ì§ íšŒì›ì´ ì•„ë‹ˆì‹ ê°€ìš”? íšŒì›ê°€ì…í•˜ê¸°</a>
    </p>
    <p class="text-center text-sm">
        <a href="index.html" class="text-gray-500 hover:text-gray-700">â† ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
    </p>
</div>


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="config.js"></script>

<script>
// config.jsì—ì„œ ì „ì—­ìœ¼ë¡œ ì„¤ì •ëœ í‚¤/URLì„ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜µë‹ˆë‹¤.
const SUPABASE_URL_FROM_WINDOW = window.SUPABASE_URL;
const SUPABASE_ANON_KEY_FROM_WINDOW = window.SUPABASE_ANON_KEY;

let supabase;

if (SUPABASE_URL_FROM_WINDOW && SUPABASE_ANON_KEY_FROM_WINDOW) {
    // ğŸ’¥ FIX ì ìš©: window.supabase ê°ì²´ì—ì„œ createClient í•¨ìˆ˜ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.
    if (window.supabase && typeof window.supabase.createClient === 'function') {
        supabase = window.supabase.createClient(SUPABASE_URL_FROM_WINDOW, SUPABASE_ANON_KEY_FROM_WINDOW, {
            auth: { persistSession: false }
        });
    } else {
        console.error('Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬(createClient)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. CDN ë¡œë“œë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        alert('Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨');
    }
} else {
    console.error('Supabase ì„¤ì • (config.js)ì„ í™•ì¸í•˜ì„¸ìš”.');
    alert('Supabase ì„¤ì •ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. config.jsë¥¼ í™•ì¸í•˜ì„¸ìš”.');
}

async function login(){
    if (!supabase) return alert('Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨');
    
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');

    if (!emailInput || !passwordInput) return alert('ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

    const email = emailInput.value.trim();
    const password = passwordInput.value;

    if (!email || !password) return alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    
    const { error } = await supabase.auth.signInWithPassword({ 
        email, 
        password 
    });

    if(error) {
        return alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + error.message);
    }
    
    alert("ë¡œê·¸ì¸ ì„±ê³µ!");
    location.href="index.html"; 
}

document.addEventListener('DOMContentLoaded', async () => {
    if (!supabase) return;
    
    const { data: { session } } = await supabase.auth.getSession();
    
    if (session) {
        console.log("ì´ë¯¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì…ë‹ˆë‹¤. ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
        location.href = "index.html";
    }
});

</script>
</body>
</html>
