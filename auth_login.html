<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>로그인 | WeNers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="config.js"></script>

<style>
/* 이미지와 일치하는 디자인을 위해 body 폰트 및 배경색 재조정 */
body { 
    font-family: 'Malgun Gothic', '맑은 고딕', 'Apple SD Gothic Neo', sans-serif; 
    background-color: #F8F9FB; /* 배경색 통일 */
}
/* 박스 스타일 조정 */
.login-box {
    @apply w-full max-w-sm bg-white p-8 rounded-xl shadow-lg; 
    border: 1px solid #e0e6f0;
}
.title-color { 
    color: #007bff; /* 회원가입 페이지와 동일한 파란색 */
    font-weight: 700;
}
/* 버튼 색상 통일 (회원가입 버튼과 동일한 시원한 파란색) */
.main-button {
    background-color: #00a0e9; 
    @apply w-full p-3 text-white rounded-lg font-semibold hover:bg-blue-700 transition duration-150 ease-in-out;
}
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

<div class="login-box">
    <h2 class="text-3xl font-bold text-gray-800 text-center mb-8 title-color">로그인</h2>

    <form id="loginForm" onsubmit="login(event)" class="space-y-4">
        <div>
            <label for="email" class="block text-sm font-medium text-gray-700">이메일 주소</label>
            <input id="email" type="email" placeholder="이메일 입력" required
                   class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"/>
        </div>
        
        <div>
            <label for="password" class="block text-sm font-medium text-gray-700">비밀번호</label>
            <input id="password" type="password" placeholder="비밀번호 입력" required
                   class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"/>
        </div>

        <button type="submit" id="loginBtn" class="main-button">
            로그인
        </button>
    </form>
    
    <p class="text-center mt-6 text-sm">
        계정이 없으신가요? 
        <a href="auth_signup.html" class="text-blue-500 hover:text-blue-700 font-medium">회원가입하기</a>
    </p>
</div>

<script>
let supabaseClient = null; // 초기화된 Supabase 클라이언트 객체를 저장할 변수

// Supabase 클라이언트 초기화 함수
function initializeSupabase() {
    const url = window.SUPABASE_URL;
    const key = window.SUPABASE_ANON_KEY;
    
    if (url && key && window.supabase && typeof window.supabase.createClient === 'function') {
        supabaseClient = window.supabase.createClient(url, key, { 
            auth: { persistSession: true, autoRefreshToken: true } 
        });
        console.log("Supabase 클라이언트 초기화 성공");
    } else {
        console.error("Supabase 클라이언트 초기화 실패: config.js 설정 오류 또는 라이브러리 로드 실패");
    }
}

// DOM 콘텐츠가 모두 로드된 후 클라이언트 초기화 시도
document.addEventListener('DOMContentLoaded', initializeSupabase);


// 로그인 함수
async function login(e){
    e.preventDefault();
    
    if(!supabaseClient) {
        alert('로그인 시스템 준비 중입니다. 잠시 후 다시 시도해 주세요.');
        // initializeSupabase(); // 재시도 (필요 시)
        return;
    }

    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    const { error } = await supabaseClient.auth.signInWithPassword({
        email: email,
        password: password
    });

    if(error) {
        console.error("로그인 오류:", error);
        return alert("로그인 실패: " + error.message);
    }
    
    alert("로그인 성공!");
    location.href="index.html";
}
</script>
</body>
</html>
