<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>로그인 | WeNers</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<h2>로그인</h2>

<input id="email" type="email" placeholder="이메일 입력" /><br>
<input id="password" type="password" placeholder="비밀번호 입력" /><br>

<button onclick="login()">로그인</button>
<p><a href="auth_signup.html">회원가입하기</a></p>

<script>
const supabase = supabase.createClient(
    "https://YOUR-PROJECT.supabase.co",
    "YOUR-ANON-KEY"
);

async function login(){
    const { data, error } = await supabase.auth.signInWithPassword({
        email: email.value,
        password: password.value
    });

    if(error) return alert("로그인 실패: "+error.message);
    alert("로그인 성공!");
    location.href="weners_with_bids_realtime_auth.html";
}
</script>


<script type="module">
// Minimal Supabase client init (persistSession:false to avoid auto login restore)
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
let SUPABASE_URL, SUPABASE_ANON_KEY;
try{
  const mod = await import('./config.js').catch(()=>null);
  if(mod && (mod.SUPABASE_URL || mod.default?.SUPABASE_URL)){
    SUPABASE_URL = mod.SUPABASE_URL || mod.default?.SUPABASE_URL;
    SUPABASE_ANON_KEY = mod.SUPABASE_ANON_KEY || mod.default?.SUPABASE_ANON_KEY;
  } else {
    SUPABASE_URL = window.SUPABASE_URL;
    SUPABASE_ANON_KEY = window.SUPABASE_ANON_KEY;
  }
}catch(e){
  SUPABASE_URL = window.SUPABASE_URL;
  SUPABASE_ANON_KEY = window.SUPABASE_ANON_KEY;
}
if(SUPABASE_URL && SUPABASE_ANON_KEY){
  window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { auth:{ persistSession:false, autoRefreshToken:false } });
} else {
  console.warn('Supabase config not found.');
}
</script>

<script>
(async ()=>{
  try{
    const btn = document.getElementById('btnLogin') || document.querySelector('button[type=submit]') || document.querySelector('button#loginBtn');
    if(!btn) return;
    btn.addEventListener('click', async (e)=>{
      try{
        if(!window.supabase) return alert('Supabase 설정 필요');
        const email = (document.getElementById('email')||document.querySelector('input[type=email]')).value.trim();
        const password = (document.getElementById('password')||document.querySelector('input[type=password]')).value;
        const { data, error } = await window.supabase.auth.signInWithPassword({ email, password });
        if(error) return alert('로그인 실패: '+error.message);
        alert('로그인 성공');
        window.location.href = 'index.html';
      }catch(err){
        console.error(err);
        alert('로그인 오류');
      }
    });
  }catch(e){ console.warn('login patch fail', e); }
})();
</script>
</body>
</html>
