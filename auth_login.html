<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>로그인 | WeNers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="config.js"></script>

<style>
body { font-family: system-ui, -apple-system, sans-serif; }
</style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

<div class="w-full max-w-sm bg-white p-8 rounded-xl shadow-2xl">
    <h2 class="text-3xl font-bold text-gray-800 text-center mb-8">로그인</h2>

    <form id="loginForm" onsubmit="login(event)" class="space-y-4">
        <div>
            <label for="email" class="block text-sm font-medium text-gray-700">이메일 주소</label>
            <input id="email" type="email" placeholder="이메일 입력" required
                   class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"/>
        </div>
        
        <div>
            <label for="password" class="block text-sm font-medium text-gray-700">비밀번호</label>
            <input id="password" type="password" placeholder="비밀번호 입력" required
                   class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"/>
        </div>

        <button type="submit" id="loginBtn" 
                class="w-full p-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition duration-150 ease-in-out">
            로그인
        </button>
    </form>
    
    <p class="text-center mt-6 text-sm">
        계정이 없으신가요? 
        <a href="auth_signup.html" class="text-blue-500 hover:text-blue-700 font-medium">회원가입하기</a>
    </p>
</div>

<script>
let supabaseClient = null; // 초기화된 Supabase 클라이언트 객체를 저장할 변수

// Supabase 클라이언트 초기화 함수
function initializeSupabase() {
    // window.SUPABASE_URL과 window.SUPABASE_ANON_KEY가 config.js를 통해 정의되었는지 확인
    const url = window.SUPABASE_URL;
    const key = window.SUPABASE_ANON_KEY;
    
    if (url && key && window.supabase && typeof window.supabase.createClient === 'function') {
        supabaseClient = window.supabase.createClient(url, key, { 
            auth: { persistSession: false, autoRefreshToken: false } 
        });
        console.log("Supabase 클라이언트 초기화 성공");
    } else {
        console.error("Supabase 클라이언트 초기화 실패: config.js 설정 오류 또는 라이브러리 로드 실패");
        alert('Supabase 클라이언트 초기화 실패. config.js를 확인하세요.');
    }
}

// DOM 콘텐츠가 모두 로드된 후 클라이언트 초기화 시도
document.addEventListener('DOMContentLoaded', initializeSupabase);


// 로그인 함수
async function login(e){
    e.preventDefault();
    
    // ⭐ 핵심 수정: 초기화된 클라이언트 객체가 있는지 확인
    if(!supabaseClient) {
        alert('로그인 시스템 준비 중입니다. 잠시 후 다시 시도하거나 config.js를 확인하세요.');
        return;
    }

    const emailEl = document.getElementById('email');
    const passwordEl = document.getElementById('password');
    
    const email = emailEl.value.trim();
    const password = passwordEl.value;

    // Supabase 로그인 API 호출
    // 59번째 줄 오류가 나던 부분: window.supabase 대신 supabaseClient 사용
    const { error } = await supabaseClient.auth.signInWithPassword({
        email: email,
        password: password
    });

    if(error) {
        console.error("로그인 오류:", error);
        return alert("로그인 실패: " + error.message);
    }
    
    alert("로그인 성공!");
    location.href="index.html";
}
</script>
</body>
</html>
